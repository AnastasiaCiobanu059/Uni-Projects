---
title: "United Flights — Exploratory Data Analysis"
author: "Anastasia Nica"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    theme: readable
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

## 📦 Load Libraries
```{r packages}
if(!require("tidyverse")) install.packages("tidyverse")
if(!require("GGally")) install.packages("GGally")
if(!require("corrplot")) install.packages("corrplot")
if(!require("lubridate")) install.packages("lubridate")
library(tidyverse)
library(GGally)
library(corrplot)
library(lubridate)
```

## 📂 Load and Transform Data
```{r load}
df <- read.csv("United flights.csv")

df <- df %>%
  mutate(
    Total_Delay = Arrival_Delay + Departure_Delay,
    Net_Delay = Arrival_Delay - Departure_Delay,
    factor_rain_origin = factor(ifelse(Rain_at_Origin == 1, "Rain", "No Rain")),
    factor_rain_dest = factor(ifelse(Rain_at_Dest == 1, "Rain", "No Rain")),
    factor_incentive = factor(ifelse(Incentive_Pay == 1, "Yes", "No")),
    Cancelled = factor(Cancelled, levels = c(0,1), labels = c("No", "Yes")),
    Date = make_date(year, Month, Day_of_Month),
    Weekday = wday(Date, label = TRUE),
    Season = case_when(
      Month %in% c(12,1,2) ~ "Winter",
      Month %in% c(3,4,5) ~ "Spring",
      Month %in% c(6,7,8) ~ "Summer",
      Month %in% c(9,10,11) ~ "Autumn"
    )
  ) %>%
  filter(!is.na(Arrival_Delay), !is.na(Departure_Delay))
```

## 📊 Correlation Matrix
```{r corr-matrix}
corr_data <- df %>%
  select(Departure_Delay, Arrival_Delay, Total_Delay, Net_Delay, Time_in_Air) %>%
  na.omit()

corr_matrix <- cor(corr_data)
corrplot(corr_matrix, method = "color", type = "upper", tl.col = "black", addCoef.col = "black")
```

## 🔁 Pairwise Relationships
```{r pairplot}
GGally::ggpairs(corr_data)
```

## 🧠 Insights Summary
```{r summary}
df %>%
  group_by(Season) %>%
  summarise(
    Flights = n(),
    Avg_Departure_Delay = mean(Departure_Delay, na.rm = TRUE),
    Avg_Arrival_Delay = mean(Arrival_Delay, na.rm = TRUE),
    Cancellation_Rate = mean(Cancelled == "Yes")
  ) %>%
  arrange(desc(Avg_Arrival_Delay))
```

## 📈 Delay by Weekday
```{r weekday-delay}
df %>%
  group_by(Weekday) %>%
  summarise(Avg_Delay = mean(Total_Delay, na.rm = TRUE)) %>%
  ggplot(aes(x = Weekday, y = Avg_Delay)) +
  geom_col(fill = "#5dade2") +
  theme_minimal() +
  labs(title = "Average Total Delay by Weekday")
```

## ☁️ Weather vs Delays
```{r weather-delay}
df %>%
  group_by(factor_rain_origin) %>%
  summarise(Avg_Delay = mean(Total_Delay, na.rm = TRUE)) %>%
  ggplot(aes(x = factor_rain_origin, y = Avg_Delay, fill = factor_rain_origin)) +
  geom_col() +
  labs(title = "Total Delay by Rain at Origin") +
  theme_minimal()
```
